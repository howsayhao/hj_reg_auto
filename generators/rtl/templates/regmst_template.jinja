{%- set mst_name = get_rtl_name(mst_node) -%}
{%- set disp_name = get_rtl_name(disp_node) -%}
{%- set prefix_o = mst_name + "__" + disp_name -%}
{%- set prefix_i = disp_name + "__" + mst_name -%}
`include "field_attr.vh"
`default_nettype none
module {{mst_name}} (
    // APB interface to upstream SoC interconnect
    pclk, presetn, psel, penable, pready, pslverr, pwrite, paddr, pwdata, prdata,
    // pslverr assertion enable
    pslverr_en,
    // interrupt signal
    intr,
    // reg_native_if to the downstream regdisp module
    {{prefix_o}}__req_vld, {{prefix_i}}__ack_vld, {{prefix_i}}__err,
    {{prefix_o}}__wr_en, {{prefix_o}}__rd_en, {{prefix_o}}__addr,
    {{prefix_o}}__wr_data, {{prefix_i}}__rd_data, {{prefix_o}}__soft_rst
);
    parameter       ADDR_WIDTH          = {{get_addr_width(mst_node)}};
    parameter       DATA_WIDTH          = {{get_data_width(mst_node)}};
    localparam      DB_REG_NUM          = 4;

    input   logic                       pclk;
    input   logic                       presetn;
    input   logic                       psel;
    input   logic                       penable;
    output  logic                       pready;
    output  logic                       pslverr;
    input   logic                       pwrite;
    input   logic   [ADDR_WIDTH-1:0]    paddr;
    input   logic   [DATA_WIDTH-1:0]    pwdata;
    output  logic   [DATA_WIDTH-1:0]    prdata;

    input   logic                       pslverr_en;
    output  logic                       intr;

    output  logic                       {{prefix_o}}__req_vld;
    input   logic                       {{prefix_i}}__ack_vld;
    input   logic                       {{prefix_i}}__err;
    output  logic                       {{prefix_o}}__wr_en;
    output  logic                       {{prefix_o}}__rd_en;
    output  logic   [ADDR_WIDTH-1:0]    {{prefix_o}}__addr;
    output  logic   [DATA_WIDTH-1:0]    {{prefix_o}}__wr_data;
    input   logic   [DATA_WIDTH-1:0]    {{prefix_i}}__rd_data;
    output  logic                       {{prefix_o}}__soft_rst;

    logic   [DB_REG_NUM-1:0]            dec_db_reg_sel;
    logic                               dec_ext_sel;
    logic 	                            dec_dummy_reg_sel;

    logic                               fsm_req_vld;
    logic                               fsm_ack_vld;
    logic                               fsm_wr_en;
    logic 	                            fsm_rd_en;
    logic   [ADDR_WIDTH-1:0]            fsm_addr;
    logic   [DATA_WIDTH-1:0]            fsm_wr_data;
    logic   [DATA_WIDTH-1:0]            fsm_rd_data;

    logic   [DATA_WIDTH-1:0]            tmr_cnt;
    logic                               tmr_tmout;
    logic                               tmr_rst;

    logic                               downstream_err;

    logic   [31:0]                      db_regs_acc_addr__snap_0_wr_data;
    logic                               db_regs_acc_addr__snap_0_wr_en;
    logic                               db_regs_acc_addr__snap_0_rd_en;
    logic   [31:0]                      db_regs_acc_addr__snap_1_wr_data;
    logic                               db_regs_acc_addr__snap_1_wr_en;
    logic                               db_regs_acc_addr__snap_1_rd_en;
    logic   [31:0]                      db_regs_acc_addr__snap_0_o;
    logic   [31:0]                      db_regs_acc_addr__snap_1_o;
    logic   [63:0]                      db_regs_acc_addr_o;
    logic   [1:0]                       db_regs_acc_addr_snapshot_snap_wr_en;
    logic   [1:0]                       db_regs_acc_addr_snapshot_snap_rd_en;
    logic   [63:0]                      db_regs_acc_addr_snapshot_snap_wr_data;
    logic   [63:0]                      db_regs_acc_addr_snapshot_snap_rd_data;
    logic   [63:0]                      db_regs_acc_addr_snapshot_reg_wr_data;
    logic   [63:0]                      db_regs_acc_addr_snapshot_reg_rd_data;
    logic                               db_regs_acc_addr_snapshot_reg_wr_en;
    logic                               db_regs_acc_addr_snapshot_reg_rd_en;
    logic   [63:0]                      db_regs_acc_addr__val__next_value;
    logic                               db_regs_acc_addr__val__pulse;
    logic   [63:0]                      db_regs_acc_addr__val__curr_value;

    logic   [31:0]                      db_regs_tmr_thr_wr_data;
    logic                               db_regs_tmr_thr_wr_en;
    logic                               db_regs_tmr_thr_rd_en;
    logic   [31:0]                      db_regs_tmr_thr_o;
    logic   [31:0]                      db_regs_tmr_thr__cnt__curr_value;

    logic   [31:0]                      db_regs_stat_wr_data;
    logic                               db_regs_stat_wr_en;
    logic                               db_regs_stat_rd_en;
    logic   [31:0]                      db_regs_stat_o;
    logic                               db_regs_stat__soft_rst__curr_value;
    logic                               db_regs_stat__err_occur__next_value;
    logic                               db_regs_stat__err_occur__pulse;
    logic   [1:0]                       db_regs_stat__err_type__next_value;
    logic                               db_regs_stat__err_type__pulse;
    logic                               db_regs_stat__acc_type__next_value;
    logic   [1:0]                       db_regs_stat__intr_mask__curr_value;
    logic                               db_regs_stat__intr__curr_value;
    logic                               db_regs_stat__intr__next_value;
    logic                               db_regs_stat__intr__pulse;

    logic   [DB_REG_NUM:0] [DATA_WIDTH-1:0]     int_rd_split_mux_din;
    logic   [DB_REG_NUM:0]                      int_rd_split_mux_sel;
    logic                                       int_rd_split_mux_dout_vld;
    logic                                       int_wr_sel;
    logic                                       dummy_reg_rd_sel;
    logic                                       dummy_reg_wr_sel;
    logic   [DB_REG_NUM-1:0] [DATA_WIDTH-1:0]   db_reg_rd_data;
    logic   [DB_REG_NUM-1:0]                    db_reg_wr_sel;
    logic   [DB_REG_NUM-1:0]                    db_reg_rd_sel;
    logic                                       int_ack_vld;
    logic   [DATA_WIDTH-1:0]                    int_rd_data;

//****************************************ADDRESS DECODER************************************************//
    // distinguish access requests to:
    //      internel debug registers
    //      external regdisp module
    //      empty address slot (dummy register)
    always_comb begin
        dec_db_reg_sel      = {DB_REG_NUM{1'b0}};
        dec_ext_sel         = 1'b0;
        dec_dummy_reg_sel   = 1'b0;
        unique casez (paddr[{{dec_addr_bit()|join(":")}}])
        {%- for child in mst_node.children(unroll=True, skip_not_present=False) %}
            {% if isinstance(child, AddrmapNode) -%}
            {{get_comp_addr(child)|join(", ")|indent}}: dec_ext_sel = 1'b1;
            {%- elif isinstance(child, RegfileNode) -%}
            {{get_abs_addr(child, 0, 4)}}: dec_db_reg_sel[0] = 1'b1;
            {{get_abs_addr(child, 1, 4)}}: dec_db_reg_sel[1] = 1'b1;
            {{get_abs_addr(child, 2, 4)}}: dec_db_reg_sel[2] = 1'b1;
            {{get_abs_addr(child, 3, 4)}}: dec_db_reg_sel[3] = 1'b1;
            {% endif -%}
        {%- endfor -%}
            default: dec_dummy_reg_sel  = 1'b1;
        endcase
    end

//*****************************************FSM INSTANCE************************************************//
    mst_fsm #(
        .ADDR_WIDTH(ADDR_WIDTH), .DATA_WIDTH(DATA_WIDTH))
    mst_fsm (
        .pclk                   (pclk),
        .presetn                (presetn),
        .psel                   (psel),
        .penable                (penable),
        .pready                 (pready),
        .pslverr                (pslverr),
        .paddr                  (paddr),
        .pwrite                 (pwrite),
        .pwdata                 (pwdata),
        .prdata                 (prdata),
        .pslverr_en             (pslverr_en),
        .fsm_req_vld            (fsm_req_vld),
        .fsm_ack_vld            (fsm_ack_vld),
        .fsm_addr               (fsm_addr),
        .fsm_wr_en              (fsm_wr_en),
        .fsm_rd_en              (fsm_rd_en),
        .fsm_wr_data            (fsm_wr_data),
        .fsm_rd_data            (fsm_rd_data),
        .downstream_err         (downstream_err),
        .tmr_tmout              (tmr_tmout),
        .tmr_rst                (tmr_rst)
    );

//*******************************************TIMER*****************************************************//
    always_ff @(posedge pclk or negedge presetn) begin
        if (!presetn)
            tmr_cnt <= {DATA_WIDTH{1'b0}};
        else if (tmr_rst)
            tmr_cnt <= {DATA_WIDTH{1'b0}};
        else if (tmr_cnt < db_regs_tmr_thr_o)
            tmr_cnt <= tmr_cnt + 1'b1;
    end

//*******************************************EVENT RECORD**********************************************//
    assign  tmr_tmout           = (tmr_cnt == db_regs_tmr_thr_o);
    assign  downstream_err      = {{prefix_i}}__err;

//******************************************DEBUG REGISTERS********************************************//
    // debug register: db_regs_acc_addr ({{bus_addr_width}}-bit)
    // description:
    //      address of the access where timeout event occurs
    // absolute address:
    // base offset:
    // reset value: 0x0
    // include 2 snapshot registers:
    //      snapshot register 0: db_regs_acc_addr__snap_0
    //          absolute address:
    //          base offset:
    //      snapshot register 1: db_regs_acc_addr__snap_1
    //          absolute address:
    //          base offset:
    field #(
        .F_WIDTH                (64),
        .ARST_VALUE             (64'h0),
        .SW_TYPE                ({`SW_RO}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_acc_addr__val (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_acc_addr_snapshot_reg_wr_data[63:0]),
        .sw_rd                  (db_regs_acc_addr_snapshot_reg_rd_en),
        .sw_wr                  (db_regs_acc_addr_snapshot_reg_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (db_regs_acc_addr__val__next_value),
        .hw_pulse               (db_regs_acc_addr__val__pulse),
        .field_value            (db_regs_acc_addr__val__curr_value)
    );
    assign  db_regs_acc_addr__val__pulse            = fsm_req_vld;
    assign  db_regs_acc_addr__val__next_value       = fsm_addr;

    always_comb begin
        db_regs_acc_addr_o[63:0]     = 64'h0;
        db_regs_acc_addr_o[63:0]     = db_regs_acc_addr__val__curr_value;
    end

    assign  db_regs_acc_addr_snapshot_reg_rd_data    = db_regs_acc_addr_o;

    assign  db_regs_acc_addr_snapshot_snap_wr_en     = {db_regs_acc_addr__snap_1_wr_en, db_regs_acc_addr__snap_0_wr_en};
    assign  db_regs_acc_addr_snapshot_snap_rd_en     = {db_regs_acc_addr__snap_1_rd_en, db_regs_acc_addr__snap_0_rd_en};
    assign  db_regs_acc_addr_snapshot_snap_wr_data   = {db_regs_acc_addr__snap_1_wr_data, db_regs_acc_addr__snap_0_wr_data};
    assign  {db_regs_acc_addr__snap_1_o, db_regs_acc_addr__snap_0_o}  = db_regs_acc_addr_snapshot_snap_rd_data;

    snapshot_reg #(.DATA_WIDTH(32), .REG_WIDTH(64))
    db_regs_acc_addr_snapshot (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .soft_rst               (1'b0),
        .snap_wr_en             (db_regs_acc_addr_snapshot_snap_wr_en),
        .snap_rd_en             (db_regs_acc_addr_snapshot_snap_rd_en),
        .snap_wr_data           (db_regs_acc_addr_snapshot_snap_wr_data),
        .snap_rd_data           (db_regs_acc_addr_snapshot_snap_rd_data),
        .reg_wr_en              (db_regs_acc_addr_snapshot_reg_wr_en),
        .reg_rd_en              (db_regs_acc_addr_snapshot_reg_rd_en),
        .reg_wr_data            (db_regs_acc_addr_snapshot_reg_wr_data),
        .reg_rd_data            (db_regs_acc_addr_snapshot_reg_rd_data)
    );

    // debug register: db_regs_tmr_thr (32-bit)
    // description:
    //      overflow threshold of the timer that
    //      counts for access cycles since regmst receives an APB transaction
    // absolute address:
    // base offset:
    // reset value: 0x63 (0d99)
    field #(
        .F_WIDTH                (32),
        .ARST_VALUE             (32'h63),
        .SW_TYPE                ({`SW_RW}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_tmr_thr__cnt (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_tmr_thr_wr_data[31:0]),
        .sw_rd                  (db_regs_tmr_thr_rd_en),
        .sw_wr                  (db_regs_tmr_thr_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (32'b0),
        .hw_pulse               (1'b0),
        .field_value            (db_regs_tmr_thr__cnt__curr_value)
    );

    always_comb begin
        db_regs_tmr_thr_o[31:0]      = 32'h0;
        db_regs_tmr_thr_o[31:0]      = db_regs_tmr_thr__cnt__curr_value;
    end

    // debug register: db_regs_stat
    // description:
    //      record status.
    // field:
    //      0:0 soft_rst,
    //      1:1 err_occur,
    //      3:2 err_type,
    //      4:4 acc_type,
    //      6:5 intr_mask,
    //      7:7 intr
    // absolute address:
    // base offset:
    // reset value: 0x0

    // field: soft_rst
    field #(
        .F_WIDTH                (1),
        .ARST_VALUE             (1'h0),
        .SW_TYPE                ({`SW_RW}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW),
        .PULSE                  ({1'b0}))
    x__db_regs_stat__soft_rst (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[0:0]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (1'b0),
        .hw_pulse               (1'b0),
        .field_value            (db_regs_stat__soft_rst__curr_value)
    );
    assign  {{prefix_o}}__soft_rst          = db_regs_stat__soft_rst__curr_value;

    // field: err_occur
    field #(
        .F_WIDTH                (1),
        .ARST_VALUE             (1'h0),
        .SW_TYPE                ({`SW_RO}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_stat__err_occur (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[1:1]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (db_regs_stat__err_occur__next_value),
        .hw_pulse               (db_regs_stat__err_occur__pulse),
        .field_value            ()
    );
    assign  db_regs_stat__err_occur__pulse           = tmr_tmout | downstream_err;
    assign  db_regs_stat__err_occur__next_value      = tmr_tmout | downstream_err;

    // field: err_type
    field #(
        .F_WIDTH                (2),
        .ARST_VALUE             (2'h0),
        .SW_TYPE                ({`SW_RO}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_stat__err_type (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[3:2]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (db_regs_stat__err_type__next_value),
        .hw_pulse               (db_regs_stat__err_type__pulse),
        .field_value            ()
    );
    assign  db_regs_stat__err_type__pulse           = tmr_tmout | downstream_err;
    assign  db_regs_stat__err_type__next_value      = {tmr_tmout, downstream_err};

    // field: acc_type
    field #(
        .F_WIDTH                (1),
        .ARST_VALUE             (1'h0),
        .SW_TYPE                ({`SW_RO}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_stat__acc_type (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[4:4]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (db_regs_stat__acc_type__next_value),
        .hw_pulse               (1'b1),
        .field_value            ()
    );
    assign  db_regs_stat__acc_type__next_value      = pwrite;

    // field: intr_mask
    field #(
        .F_WIDTH                (2),
        .ARST_VALUE             (2'h0),
        .SW_TYPE                ({`SW_RW}),
        .HW_TYPE                (`HW_RO),
        .PRECEDENCE             (`SW))
    x__db_regs_stat__intr_mask (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[6:5]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (2'b0),
        .hw_pulse               (1'b0),
        .field_value            (db_regs_stat__intr_mask__curr_value)
    );

    // field: intr
    field #(
        .F_WIDTH                (1),
        .ARST_VALUE             (1'h0),
        .SW_TYPE                ({`SW_RW}),
        .HW_TYPE                (`HW_RW),
        .PRECEDENCE             (`SW))
    x__db_regs_stat__intr (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .sync_rst               (1'b0),
        .sw_wr_data             (db_regs_stat_wr_data[7:7]),
        .sw_rd                  (db_regs_stat_rd_en),
        .sw_wr                  (db_regs_stat_wr_en),
        .write_protect_en       (1'b0),
        .sw_type_alter_signal   (1'b0),
        .swmod_out              (),
        .swacc_out              (),
        .hw_value               (db_regs_stat__intr__next_value),
        .hw_pulse               (db_regs_stat__intr__pulse),
        .field_value            (db_regs_stat__intr__curr_value)
    );
    assign  db_regs_stat__intr__pulse       = |(db_regs_stat__intr_mask__curr_value & {tmr_tmout, downstream_err});
    assign  db_regs_stat__intr__next_value  = 1'b1;

    assign  intr                            = db_regs_stat__intr__curr_value;

    // concatenation of all software-readable fields
    always_comb begin
        db_regs_stat_o[31:0]    = 32'h0;
        db_regs_stat_o[0:0]     = db_regs_stat__soft_rst__curr_value;
        db_regs_stat_o[6:5]     = db_regs_stat__intr_mask__curr_value;
        db_regs_stat_o[7:7]     = db_regs_stat__intr__curr_value;
    end


//*************************INTERNAL/EXTERNAL MUX/IMUX INSTANCE*****************************************//
    // internal register multiplexor: rd_data and ack_vld from debug registers
    assign  db_reg_rd_data[0]           = db_regs_acc_addr__snap_0_o;
    assign  db_reg_rd_data[1]           = db_regs_acc_addr__snap_1_o;
    assign  db_reg_rd_data[2]           = db_regs_tmr_thr_o;
    assign  db_reg_rd_data[3]           = db_regs_stat_o;

    assign  int_rd_split_mux_din        = {db_reg_rd_data, {DATA_WIDTH{1'b0}}};
    assign  int_rd_split_mux_sel        = {db_reg_rd_sel, dummy_reg_rd_sel};
    assign  int_wr_sel                  = (| db_reg_wr_sel) | dummy_reg_wr_sel;
    split_mux_2d #(
        .WIDTH(DATA_WIDTH), .CNT(DB_REG_NUM+1),
        .GROUP_SIZE(128), .SKIP_DFF_0(1), .SKIP_DFF_1(1))
    int_rd_split_mux (
        .clk                    (pclk),
        .rst_n                  (presetn),
        .din                    (int_rd_split_mux_din),
        .sel                    (int_rd_split_mux_sel),
        .dout                   (int_rd_data),
        .dout_vld               (int_rd_split_mux_dout_vld));

    assign  int_ack_vld         = int_rd_split_mux_dout_vld | int_wr_sel;

    // internal register inverse multiplexor to debug registers
    assign  db_reg_wr_sel               = {DB_REG_NUM{fsm_wr_en}} & dec_db_reg_sel;
    assign  db_reg_rd_sel               = {DB_REG_NUM{fsm_rd_en}} & dec_db_reg_sel;
    assign  dummy_reg_rd_sel            = dec_dummy_reg_sel & fsm_req_vld & fsm_rd_en;
    assign  dummy_reg_wr_sel            = dec_dummy_reg_sel & fsm_req_vld & fsm_wr_en;

    assign  db_regs_acc_addr__snap_0_wr_data = db_reg_wr_sel[0] ? fsm_wr_data : {DATA_WIDTH{1'b0}};
    assign  db_regs_acc_addr__snap_0_wr_en   = db_reg_wr_sel[0];
    assign  db_regs_acc_addr__snap_0_rd_en   = db_reg_rd_sel[0];

    assign  db_regs_acc_addr__snap_1_wr_data = db_reg_wr_sel[1] ? fsm_wr_data : {DATA_WIDTH{1'b0}};
    assign  db_regs_acc_addr__snap_1_wr_en   = db_reg_wr_sel[1];
    assign  db_regs_acc_addr__snap_1_rd_en   = db_reg_rd_sel[1];

    assign  db_regs_tmr_thr_wr_data          = db_reg_wr_sel[2] ? fsm_wr_data : {DATA_WIDTH{1'b0}};
    assign  db_regs_tmr_thr_wr_en            = db_reg_wr_sel[2];
    assign  db_regs_tmr_thr_rd_en            = db_reg_rd_sel[2];

    assign  db_regs_stat_wr_data         = db_reg_wr_sel[3] ? fsm_wr_data : {DATA_WIDTH{1'b0}};
    assign  db_regs_stat_wr_en           = db_reg_wr_sel[3];
    assign  db_regs_stat_rd_en           = db_reg_rd_sel[3];

    // ultimate multiplexor to mst_fsm: ack_vld, rd_data, err
    assign  fsm_rd_data                 = int_ack_vld ? int_rd_data : ({{prefix_i}}__ack_vld ? {{prefix_i}}__rd_data : {DATA_WIDTH{1'b0}});
    assign  fsm_ack_vld                 = int_ack_vld | {{prefix_i}}__ack_vld;

    // ultimate inverse multiplexor: to the external downstream regdisp module
    assign  {{prefix_o}}__req_vld       = fsm_req_vld & dec_ext_sel;
    assign  {{prefix_o}}__wr_en         = fsm_wr_en & dec_ext_sel;
    assign  {{prefix_o}}__rd_en         = fsm_rd_en & dec_ext_sel;
    assign  {{prefix_o}}__addr          = dec_ext_sel ? fsm_addr : {ADDR_WIDTH{1'b0}};
    assign  {{prefix_o}}__wr_data       = dec_ext_sel ? fsm_wr_data : {DATA_WIDTH{1'b0}};
endmodule
`default_nettype wire